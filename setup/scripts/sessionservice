#!/bin/bash
# example sessionservice 
cd ../autogenerated
DIR=.
filename='./(\w*).\w*.(\w*)'

for i in $DIR/log.access.*; do
	[[ $i =~ $filename ]]
	dest="${BASH_REMATCH[2]}"
	out="log-${dest}.service"
	dest="$dest" envsubst < ../files/template.service > "$out"
done


# write a script to enable and start these services
scriptfile=./enable-logging-clients.sh
touch "${scriptfile}"
rm "${scriptfile}"
echo "#!/bin/bash" >> "${scriptfile}"
for i in $DIR/log.access.*; do
	[[ $i =~ $filename ]]
	dest="${BASH_REMATCH[2]}"
	service="$dest" envsubst < ../files/template.start >> "${scriptfile}"
done
chmod +x "${scriptfile}"

# write a script to disable and stop these services
scriptfile=./disable-logging-clients.sh
touch "${scriptfile}"
rm "${scriptfile}"
echo "#!/bin/bash" >> "${scriptfile}"
for i in $DIR/log.access.*; do
	[[ $i =~ $filename ]]
	dest="${BASH_REMATCH[2]}"
	service="$dest" envsubst < ../files/template.stop >> "${scriptfile}"
done
chmod +x "${scriptfile}"
